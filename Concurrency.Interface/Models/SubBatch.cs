using System;
using System.Collections.Generic;

namespace Concurrency.Interface.Models
{
    [Serializable]
    public record SubBatch   // sent from global coordinator to local coordinator
    {
        public long Bid { get; init; }

        public long CoordinatorId { get; init; }

        public long PreviousBid { get; set; }

        public List<long> Transactions { get; init; }

        // NOTICE: this field is only used for batches generated by local coordinators
        public long lastGlobalBid;

        public SubBatch(long bid, long coordinatorId)
        {
            this.PreviousBid = -1;
            this.Bid = bid;
            this.CoordinatorId = coordinatorId;
            this.Transactions = new List<long>();
            this.lastGlobalBid = -1;
        }

        public SubBatch(SubBatch subBatch)
        {
            this.Bid = subBatch.Bid;
            this.CoordinatorId = subBatch.CoordinatorId;
            this.PreviousBid = subBatch.PreviousBid;
            this.Transactions = subBatch.Transactions;
            this.lastGlobalBid = subBatch.lastGlobalBid;
        }

        public override string ToString()
        {
            return $"Bid: {this.Bid}, PreviousBid: {this.PreviousBid}, CoordinatorId: {this.CoordinatorId}, lastGlobalBid: {lastGlobalBid}, Transactions: [{string.Join(", ", this.Transactions)}]";
        }
    }
}